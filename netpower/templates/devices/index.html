{% extends "base.html" %}

{% block title %}è®¾å¤‡ç®¡ç† - Wake on LAN{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="section-header">
        <h2>æ·»åŠ è®¾å¤‡</h2>
        <button id="toggle-add-form" class="toggle-btn">
            <span class="toggle-icon">+</span>
        </button>
    </div>

    <div class="add-device" id="add-device-form">
        <form action="{{ url_for('devices.add_device') }}" method="post" id="add-form" data-validate="true">
            <div class="form-grid">
                <div class="form-group">
                    <label for="name">åç§°</label>
                    <input type="text" name="name" required placeholder="è¾“å…¥è®¾å¤‡åç§°">
                </div>
                <div class="form-group">
                    <label for="mac">MACåœ°å€</label>
                    <input type="text" name="mac" required placeholder="æ ¼å¼: 00:11:22:33:44:55">
                </div>
                <div class="form-group">
                    <label for="ip">IPåœ°å€</label>
                    <input type="text" name="ip" required placeholder="æ ¼å¼: 192.168.1.100">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn-primary">æ·»åŠ è®¾å¤‡</button>
                </div>
            </div>
        </form>
    </div>

    <div class="section-header devices-header">
        <h2>è®¾å¤‡åˆ—è¡¨</h2>
        <a href="{{ url_for('devices.refresh_status') }}" class="refresh-btn">
            <span class="refresh-icon">âŸ³</span> åˆ·æ–°çŠ¶æ€
        </a>
    </div>
    
    {% if devices %}
        <div class="device-grid">
            {% for index in range(devices|length) %}
                {% set device = devices[index] %}
                <div class="device-card">
                    <div class="device-card-header">
                        <h3>{{ device.name }}</h3>
                        <div class="status-badge {{ 'online' if device.status else 'offline' }}">
                            {{ 'åœ¨çº¿' if device.status else 'ç¦»çº¿' }}
                        </div>
                    </div>
                    <div class="device-card-body">
                        <div class="device-info">
                            <div class="info-item">
                                <span class="info-label">MAC:</span>
                                <span class="info-value">{{ device.mac }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">IP:</span>
                                <span class="info-value">{{ device.ip }}</span>
                            </div>
                        </div>
                        <div class="device-actions">
                            <a href="{{ url_for('devices.wake_up', device_id=index) }}" class="action-btn wake-btn" title="å”¤é†’è®¾å¤‡">
                                <span class="btn-icon">â–¶</span> å”¤é†’
                            </a>
                            <a href="{{ url_for('devices.edit_device_page', device_id=index) }}" class="action-btn edit-btn" title="ç¼–è¾‘è®¾å¤‡">
                                <span class="btn-icon">âœ</span> ç¼–è¾‘
                            </a>
                            <button type="button" class="action-btn delete-btn" onclick="confirmDelete({{ index }})" title="åˆ é™¤è®¾å¤‡">
                                <span class="btn-icon">âœ•</span> åˆ é™¤
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-devices">
            <div class="empty-state">
                <div class="empty-icon">ğŸ“¦</div>
                <p>æ²¡æœ‰è®¾å¤‡ã€‚è¯·æ·»åŠ è®¾å¤‡å¼€å§‹ä½¿ç”¨ã€‚</p>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block modals %}
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ç¡®è®¤åˆ é™¤</h3>
            <span class="close-modal" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¾å¤‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚</p>
        </div>
        <div class="modal-buttons">
            <button class="cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
            <a id="confirmDeleteLink" href="#"><button class="delete-btn">åˆ é™¤</button></a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
function confirmDelete(deviceId) {
    var modal = document.getElementById('deleteModal');
    var confirmLink = document.getElementById('confirmDeleteLink');
    confirmLink.href = "{{ url_for('devices.delete_device', device_id=0) }}".replace("0", deviceId);
    modal.style.display = "block";
}

function closeModal() {
    document.getElementById('deleteModal').style.display = "none";
}

window.onclick = function(event) {
    var modal = document.getElementById('deleteModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

// åˆ‡æ¢æ·»åŠ è®¾å¤‡è¡¨å•æ˜¾ç¤º/éšè—
document.getElementById('toggle-add-form').addEventListener('click', function() {
    var form = document.getElementById('add-device-form');
    var icon = this.querySelector('.toggle-icon');
    
    if (form.classList.contains('expanded')) {
        form.classList.remove('expanded');
        icon.textContent = '+';
    } else {
        form.classList.add('expanded');
        icon.textContent = 'âˆ’';
    }
});

// é¡µé¢åŠ è½½æ—¶å±•å¼€æ·»åŠ è®¾å¤‡è¡¨å•
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('.add-device').classList.add('expanded');
    document.querySelector('.toggle-icon').textContent = 'âˆ’';
});
{% endblock %}
